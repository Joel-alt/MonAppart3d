<html>

<head>
    <title>Le plus bel appartement du monde</title>
    <script type='text/javascript' src='../x3dom/x3dom.js'></script>
    <link rel='stylesheet' type='text/css' href='../x3dom/x3dom.css'>
    </link>
</head>

<body>
    <div id="plan" onclick="moveCamera(event)" style="position: absolute; z-index: 1">
        <img src="plan.png" alt="Plan de l'appartement" style="height: auto;width: 300px">
    </div>
    <div id="metadataDisplay" style="background-color: white; position: absolute; z-index: 1;"></div>
    <div style="background-color: white; position: absolute; z-index: 1; top: 0; right: 0; padding: 0px 10px;">
        <p>
            Commandes :
        <ul>
            <li>Click gauche : avancer</li>
            <li>Click droit : reculer</li>
        </ul>
        </p>
    </div>


    <div id="scene">
        <x3d>
            <scene>


                <!-- <navigationInfo type='"walk" "any"' id="navType"></navigationInfo>  -->


                <Viewpoint id="camera" position="-5 1.5 -1" orientation="-0.08553 -0.99409 -0.06683 1.61266"
                    description="camera"></Viewpoint>
                <background id="bg" skyColor="0.8 0.9 1.0"></background>

                <!-- SOLS -->
                <!-- Grand rectangle -->
                <transform translation='0 0 -1'>
                    <shape>
                        <appearance>
                            <material diffuseColor='0.7, 0.5, 0.3'></material>
                        </appearance>
                        <box size='5 0.1 14'></box>
                    </shape>
                </transform>
                <!-- Petit rectangle -->
                <transform translation='-4 0 4'>
                    <shape>
                        <appearance>
                            <material diffuseColor='0.7, 0.5, 0.3'></material>
                        </appearance>
                        <box size='3 0.1 4'></box>
                    </shape>
                </transform>
                <!-- Balcon -->
                <transform translation='-4 0 6.5'>
                     <inline url="balcon.x3d"> </inline>
                </transform>

                <!-- MURS -->
                <!-- Mur gauche chambre Astryd -->
                <transform translation='-5.5 1 4'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='0.1 2 4'></box>
                    </shape>
                </transform>

                <!-- Mur du fond chambre Astryd -->
                <transform translation='-4.05 1 2'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='3 2 0.1'></box>
                    </shape>
                </transform>

                <!-- Mur du fond chambre Amel -->
                <transform translation='0 1 -8.05'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='5 2 0.1'></box>
                    </shape>
                </transform>

                <!-- Murs Salon-->
                <transform translation='-0.08 1.02 5.95'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='5.15 1.96 0.1'></box>
                    </shape>
                </transform>
                

                <!-- Mur chambre Amélie et SBD -->
                <transform translation='0.62 1 -4.65'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='3.75 2 0.1'></box>
                    </shape>
                </transform>

                <!-- Mur gauche salle de bain -->
                <transform translation='0.65 1 -2.63'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='0.1 2 1.55'></box>
                    </shape>
                </transform>

                <!-- Mur salle de bain cuisine -->
                <transform translation='1 1.02 -1.8'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='3 1.96 0.1'></box>
                    </shape>s
                </transform>

                <!-- Mur gauche cuisine -->
                <transform translation='-0.55 1 -1.33'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='0.1 2 3.95'></box>
                    </shape>
                </transform>

                <!-- Mur gauche chambre Amel -->
                <transform translation='-2.5 1 -4.85'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='0.1 2 6.5'></box>
                    </shape>
                </transform>

                <!-- Mur salon /chambre astryd-->
                <transform translation='-2.5 1 2'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='0.1 2 4.8'></box>
                    </shape>
                </transform>

                <!-- Mur droit chambre Astryd -->
                <transform translation='-2.5 1 5.8'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='0.1 2 0.4'></box>
                    </shape>
                </transform>

                 <!-- Mur Salon & SDB-->
                 <!--Bas-->
                <transform translation='2.545 0.514 0.65'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='0.1 1.13 10.7'></box>
                    </shape>
                </transform>
                <!--Hauts-->
                <transform translation='2.545 1.516 5.45'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='0.1 0.965 1.1'></box>
                    </shape>
                </transform>
                <transform translation='2.545 1.516 1.425'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='0.1 0.965 1.76'></box>
                    </shape>
                </transform>
                <transform translation='2.545 1.516 -1.25'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='0.1 0.965 1.81'></box>
                    </shape>
                </transform>
                <transform translation='2.545 1.516 -3.87'>
                    <shape>
                        <appearance>
                            <material diffuseColor='1 1 1'></material>
                        </appearance>
                        <box size='0.1 0.965 1.65'></box>
                    </shape>
                </transform>

                <!--FENETRES-->
                <!-- Fenetre Cuisine -->
                <transform translation='3.1 0.5 1' rotation='0 1 0 1.5708'>
                    <inline url="fenetre.x3d"> </inline>
                </transform>

                <!-- Fenetres Salon -->
                <transform translation='3.1 0.5 3.65' rotation='0 1 0 1.5708'>
                    <inline url="fenetre.x3d"> </inline>
                </transform>
                <transform translation='3.1 0.5 4.5' rotation='0 1 0 1.5708'>
                    <inline url="fenetre.x3d"> </inline>
                </transform>
                <transform translation='3.1 0.5 5.35' rotation='0 1 0 1.5708'>
                    <inline url="fenetre.x3d"> </inline>
                </transform>

                <!-- Fenetre SDB -->
                <transform translation='3.1 0.5 -1.7' rotation='0 1 0 1.5708'>
                    <inline url="fenetre.x3d"> </inline>
                </transform>

                <!-- Lit Astryd -->
                <transform translation='-4.65 0.3 2.9' rotation='0 1 0 -1.5708' onclick="handleClick(event)">
                    <inline nameSpaceName="LitAstryd" url="lit.x3d">
                        <metadata>
                            <MetadataSet>
                                <MetadataString name="ObjectName" value="Lit d'Astryd" />
                                <MetadataString name="Description" value="C'est le lit d'Astryd" />
                                <MetadataString name="Price" value="300 euros" />
                            </MetadataSet>
                        </metadata>
                    </inline>
                </transform>

                <!-- Lit Amel -->
                <transform translation='1.7 0.3 -6.68' rotation='0 1 0 1.5708' onclick="handleClick(event)">
                    <inline nameSpaceName="LitAmel" url="lit.x3d"> 
                        <metadata>
                            <MetadataSet>
                                <MetadataString name="ObjectName" value="Lit d'Amel" />
                                <MetadataString name="Description" value="C'est le lit d'Amel" />
                                <MetadataString name="Price" value="400 euros" />
                            </MetadataSet>
                        </metadata>
                    </inline>
                </transform>

                <!-- Armoire Astryd-->
                <transform translation='-5.2 1 4.95' rotation='0 1 0 1.5708'>
                    <inline url="armoire.x3d"> </inline>
                </transform>

                <!-- Armoire Amel 1-->
                <transform translation='0.25 1.05 -4.95' rotation='0 1 0 3.1416'>
                    <inline url="armoire.x3d"> </inline>
                </transform>

                <!-- Armoire Amel 2-->
                <transform translation='1.75 1.05 -4.95' rotation='0 1 0 3.1416'>
                    <inline url="armoire.x3d"> </inline>
                </transform>

                <!-- Table de nuit Astryd-->
                <transform translation='-5.2 0.3 3.95' rotation='0 1 0 1.5708'>
                    <inline url="tableDeNuit.x3d"> </inline>
                </transform>

                <!-- Table de nuit Amel-->
                <transform translation='2.25 0.3 -7.75' rotation='0 1 0 -1.5708'>
                    <inline url="tableDeNuit.x3d"> </inline>
                </transform>

                <!-- Bureau Astryd-->
                <transform translation='-3.2 0.35 2.5' rotation='0 1 0 0'>
                    <inline url="bureau.x3d"> </inline>
                </transform>

                <!-- Bureau Amel-->
                <transform translation='-2 0.35 -7.35' rotation='0 1 0 1.5708'>
                    <inline url="bureau.x3d"> </inline>
                </transform>

                <!-- Chaise de Bureau Astryd-->
                <transform translation='-3.2 0 2.9' rotation='0 1 0 3.1416'>
                    <inline url="chaiseDeBureau.x3d"> </inline>
                </transform>

                <!-- Chaise de Bureau Amel-->
                <transform translation='-1.7 0 -7.35' rotation='0 1 0 -1.5708'>
                    <inline url="chaiseDeBureau.x3d"> </inline>
                </transform>

                <!-- Ordinateur Astryd -->
                <transform translation='-3.2 0.57 2.25' rotation='0 1 0 0'>
                    <inline url="ordinateur.x3d"> </inline>
                </transform>

                <!-- Ordinateur Amel -->
                <transform translation='-2.35 0.57 -7.35' rotation='0 1 0 1.5708'>
                    <inline url="ordinateur.x3d"> </inline>
                </transform>

                <!-- Radiateur Astryd-->
                <transform translation='-4.8 0 5.9' rotation='0 1 0 3.1416'>
                    <inline url="radiateur.x3d"> </inline>
                </transform>

                <!-- Radiateur Amel-->
                <transform translation='0 0 -7.9' rotation='0 1 0 3.1416'>
                    <inline url="radiateur.x3d"> </inline>
                </transform>

                <!-- Radiateur Salon-->
                <transform translation='2.45 0 4.7' rotation='0 1 0 1.5708'>
                    <inline url="radiateur.x3d"> </inline>
                </transform>

                <!-- Canapé -->
                <transform translation='0 -0.1 5.5' rotation='0 1 0 3.1416'>
                    <inline url="canape.x3d"> </inline>
                </transform>

                <!-- Fauteuil -->
                <transform translation='1.8 -0.1 5.2' rotation='0 1 0 -2.6416'>
                    <inline url="fauteuil.x3d"> </inline>
                </transform>

                <!-- Meuble télé -->
                <transform translation='-2.25 0 2.7' rotation='0 1 0 1.5708'>
                    <inline url="meubleTele.x3d"> </inline>
                </transform>

                <!-- Télé -->
                <transform translation='-2.25 0.6 2.7' rotation='0 1 0 1.5708'>
                    <inline url="tele.x3d"> </inline>
                </transform>

                <!-- Arbre -->
                <transform translation='-2.1 0 1' rotation='0 1 0 1.5708'>
                    <inline url="arbre.x3d"> </inline>
                </transform>

                <!-- Table Salon -->
                <transform translation='0.5 0 3' rotation='0 1 0 0'>
                    <inline url="tableSalon.x3d"> </inline>
                </transform>

                <!-- Chaise de Salon-->
                <transform translation='-0.2 0 2.4' rotation='0 1 0 0.8'>
                    <inline url="chaiseDeBureau.x3d"> </inline>
                </transform>

                <!-- Chaise de Salon-->
                <transform translation='1.2 0 2.4' rotation='0 1 0 -0.8'>
                    <inline url="chaiseDeBureau.x3d"> </inline>
                </transform>

                <!-- Chaise de Salon-->
                <transform translation='-0.2 0 3.6' rotation='0 1 0 2.3'>
                    <inline url="chaiseDeBureau.x3d"> </inline>
                </transform>

                <!-- Chaise de Salon-->
                <transform translation='1.2 0 3.6' rotation='0 1 0 -2.3'>
                    <inline url="chaiseDeBureau.x3d"> </inline>
                </transform>

                <!-- Meuble de cusine gauche -->
                <transform translation='2.25 0.05 0.3' rotation='0 1 0 -1.5708' scale='1 0.85 1'>
                    <inline url="meubleCuisineGauche.x3d"> </inline>
                </transform>

                <!-- Frigo -->
                <transform translation='2.2 0.05 -1.35' rotation='0 1 0 -1.5708'>
                    <inline url="frigo.x3d"> </inline>
                </transform>

                <!-- Evier -->
                <transform translation='-0.2 0 -1.15' rotation='0 1 0 -1.5708' scale='1 0.85 1'>
                    <inline url="evier.x3d"> </inline>
                </transform>

                <!-- Cuisinière -->
                <transform translation='-0.2 0 0.05' rotation='0 1 0 1.5708' scale='1 0.85 1'>
                    <inline url="cuisiniere.x3d"> </inline>
                </transform> 

                <!-- Douche -->
                <transform translation='1.25 0 -1.85' rotation='0 1 0 3.1416'>
                    <inline url="douche.x3d"> </inline>
                </transform>

                <!-- Toilettes -->
                <transform translation='0 0 -2.3 ' rotation='0 1 0 3.1416'>
                    <inline url="toilettes.x3d"> </inline>
                </transform>

                <!-- Lavabo -->
                <transform translation='2.2 0.05 -4' rotation='0 1 0 1.5708'>
                    <inline url="lavabo.x3d"> </inline>
                </transform>

                <!-- Machine à Laver -->
                <transform translation='2.15 0.05 -2.3' rotation='0 1 0 0' scale='1 0.85 1'>
                    <inline url="machineAlaver.x3d"> </inline>
                </transform>

                <!-- PORTES -->
                <!-- Encadrement porte d'entrée-->
                <transform translation='-2.5 0.05 -1' rotation='0 1 0 0'>
                    <inline url="encadrementPorte.x3d"> </inline>
                </transform>

                <!-- Encadrement porte Astryd -->
                <transform translation='-2.5 0.05 5' rotation='0 1 0 0'>
                    <inline url="encadrementPorte.x3d"> </inline>
                </transform>

                <!-- Encadrement porte SDB -->
                <transform translation='0.65 0.05 -4' rotation='0 1 0 0'>
                    <inline url="encadrementPorte.x3d"> </inline>
                </transform>

                <!-- Encadrement porte WC -->
                <transform translation='0 0.05 -3.35' rotation='0 1 0 1.5708'>
                    <inline url="encadrementPorte.x3d"> </inline>
                </transform>

                <!-- Encadrement porte Amélie -->
                <transform translation='-1.85 0.05 -4.65' rotation='0 1 0 1.5708'>
                    <inline url="encadrementPorte.x3d"> </inline>
                </transform>



            </scene>
        </x3d>
    </div>


    <script type="text/javascript">
        function moveCamera(event) {
            console.log(event);
            const mouseX = event.clientX;
            const mouseY = event.clientY;
            const camera = document.getElementById('camera');

            //si le user clique sur la zone salon
            if (mouseX > 43 && mouseX < 130 && mouseY > 77 && mouseY < 169) {
                camera.position = '3.20444 1.5 1.06801';
                camera.orientation = '-0.11932 0.97382 0.19349 2.04361';
            }
            //si le user clique sur la zone chambre Astryd
            if (mouseX > 43 && mouseX < 130 && mouseY > 15 && mouseY <= 77) {
                camera.position = '-2.95071 1.5 6.89617';
                camera.orientation = '-0.80903 0.58535 0.05324 0.22434';
            }
            console.log("x:" + mouseX + " y:" + mouseY)
            //si le user clique sur la zone chambre Amel
            if (mouseX > 243 && mouseX < 295 && mouseY > 77 && mouseY < 169) {
                camera.position = '-3.06452 1.5 -2.11215';
                camera.orientation = '-0.24006 -0.96176 -0.13185 0.92074';
            }
            //si le user clique sur la zone cuisine
            if (mouseX > 134 && mouseX < 185 && mouseY > 105 && mouseY < 169) {
                camera.position = '3.35560 1.5 -1.99173';
                camera.orientation = '-0.07730 0.99024 0.11598 1.99011';
            }
        }

        function handleClick(event) {
            const clickedObject = event.target.closest('inline');
            if (clickedObject) {
                const metadata = extractMetadata(clickedObject);
                document.getElementById('metadataDisplay').style.left = event.layerX + 'px';
                document.getElementById('metadataDisplay').style.top = event.layerY + 'px';
                updateUI(metadata);
            }
        }

        function extractMetadata(object) {
            const metadataNode = object.querySelector('metadata');
            const metadataSetNode = metadataNode.querySelector('metadataset');
            const metadata = {};

            if (metadataSetNode) {
                metadataSetNode.querySelectorAll('MetadataString').forEach((metadataStringNode) => {
                    const name = metadataStringNode.getAttribute('name');
                    const value = metadataStringNode.getAttribute('value');
                    metadata[name] = value;
                });
            }

            return metadata;
        }

        function updateUI(metadata) {
            const metadataDisplay = document.getElementById('metadataDisplay');
            metadataDisplay.innerHTML = `<div id="metadataContent" style="display:flex; flex-direction:column; padding:0px 10px"><button style="align-self:flex-end" onclick="document.getElementById('metadataContent').remove()">X</button><p>Nom: ${metadata.ObjectName}</p><p>Prix: ${metadata.Price}</p><p>Description: ${metadata.Description}</p><div>`;
        }
    </script>
</body>

</html>